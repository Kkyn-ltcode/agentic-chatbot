import duckdb

con = duckdb.connect()

query = """
SELECT a.ID AS id1, b.ID AS id2
FROM read_parquet('flows.parquet') a
JOIN read_parquet('flows.parquet') b
ON a.Src = b.Src
WHERE a.ID <> b.ID
UNION ALL
SELECT a.ID, b.ID FROM read_parquet('flows.parquet') a JOIN read_parquet('flows.parquet') b ON a.Src = b.Dst WHERE a.ID <> b.ID
UNION ALL
SELECT a.ID, b.ID FROM read_parquet('flows.parquet') a JOIN read_parquet('flows.parquet') b ON a.Dst = b.Dst WHERE a.ID <> b.ID
UNION ALL
SELECT a.ID, b.ID FROM read_parquet('flows.parquet') a JOIN read_parquet('flows.parquet') b ON a.Dst = b.Src WHERE a.ID <> b.ID;
"""

edges = con.execute(query).pl()
edges.write_parquet("edges.parquet")

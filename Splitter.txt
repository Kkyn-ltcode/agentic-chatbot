from torch_geometric.loader import NeighborSampler
from torch_sparse import SparseTensor

# Build adjacency as SparseTensor
adj_t = SparseTensor(row=edge_index[0], col=edge_index[1],
                     sparse_sizes=(num_nodes, num_nodes))

# Create sampler
train_loader = NeighborSampler(
    adj_t,
    node_idx=torch.arange(num_nodes),  # which nodes to sample from
    sizes=[15, 10, 5],                 # sample 15, 10, 5 neighbors per layer
    batch_size=1024,
    shuffle=True,
)

# Each iteration returns:
#  - batch_size (int)
#  - n_id (list of node indices involved)
#  - adjs (list of SparseTensors for each GNN layer)
for batch_size, n_id, adjs in train_loader:
    # You must manually get x[n_id] and y[n_id] yourself
    x_batch = x[n_id]
    out = model(x_batch, adjs)

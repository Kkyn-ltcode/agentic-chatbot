// ... (imports)

const Message = ({ message, isLast, db }) => {
  const [showFeedbackForm, setShowFeedbackForm] = useState(false);
  const [feedbackText, setFeedbackText] = useState('');

  const handleSubmitFeedback = async () => {
    if (!db || !feedbackText.trim()) return;
    try {
      const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
      const feedbackCollectionRef = collection(db, `artifacts/${appId}/public/feedback`);
      await addDoc(feedbackCollectionRef, {
        feedback: feedbackText,
        timestamp: serverTimestamp(),
      });
      setFeedbackText('');
      setShowFeedbackForm(false);
      console.log("Feedback submitted successfully!");
    } catch (error) {
      console.error("Error writing feedback to Firestore:", error);
    }
  };

  const isUser = message.sender === 'user';
  const messageClass = isUser ? 'self-end bg-blue-600 text-white rounded-br-none' : 'self-start bg-gray-200 text-gray-900 rounded-bl-none';
  
  return (
    <div className={`flex flex-col mb-4 max-w-lg ${isUser ? 'items-end' : 'items-start'}`}>
      {/* ... existing message bubble ... */}
      {/* Conditionally render the button collection for the model's last message */}
      {!isUser && isLast && (
        <div className="flex items-center space-x-2 mt-2">
          {/* Thumbs up/down, Copy buttons would go here */}
+          {/* Feedback Button */}
+          <button
+            onClick={() => setShowFeedbackForm(!showFeedbackForm)}
+            className="p-2 text-gray-500 hover:text-blue-600"
+            aria-label="Give feedback"
+          >
+            <svg
+              xmlns="http://www.w3.org/2000/svg"
+              width="20"
+              height="20"
+              viewBox="0 0 24 24"
+              fill="none"
+              stroke="currentColor"
+              strokeWidth="2"
+              strokeLinecap="round"
+              strokeLinejoin="round"
+            >
+              <path d="M12 2a10 10 0 0 0-9.8 11.2C2.8 14.5 4 16 5.5 16H8v-2a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2h2.5c1.5 0 2.7-1.5 2.3-2.8A10 10 0 0 0 12 2zM12 2a10 10 0 0 1 8.8 5.2c.4 1.3-.8 2.8-2.3 2.8H16v2a1 1 0 0 1-1 1h-6a1 1 0 0 1-1-1v-2H5.5C4 10 2.8 8.5 3.2 7.2A10 10 0 0 1 12 2z"/>
+            </svg>
+          </button>
+        </div>
      )}
      {/* Conditionally render the feedback form */}
      {showFeedbackForm && (
        <div className="mt-4 w-full">
          <textarea
            className="w-full p-2 border border-gray-300 rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"
            rows="3"
            placeholder="Tell us what you think..."
            value={feedbackText}
            onChange={(e) => setFeedbackText(e.target.value)}
          />
          <button
            onClick={handleSubmitFeedback}
            disabled={!feedbackText.trim()}
            className="mt-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400"
          >
            Submit Feedback
          </button>
        </div>
      )}
    </div>
  );
};

// ... (export and other parts)

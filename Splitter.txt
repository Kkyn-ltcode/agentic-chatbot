import pikepdf
import pdfplumber
import json

# If encrypted, open with password first
pdf = pikepdf.open('encrypted.pdf', password='your_password')
pdf.save('temp_decrypted.pdf')

# Extract text with better formatting
with pdfplumber.open('temp_decrypted.pdf') as pdf:
    # Save as .txt
    with open('output.txt', 'w', encoding='utf-8') as txt_file:
        for page in pdf.pages:
            txt_file.write(page.extract_text() + "\n\n")
    
    # Save as .json with more details
    pages_data = []
    for page in pdf.pages:
        pages_data.append({
            "page_number": page.page_number,
            "text": page.extract_text(),
            "width": page.width,
            "height": page.height
        })
    
    with open('output.json', 'w', encoding='utf-8') as json_file:
        json.dump(pages_data, json_file, ensure_ascii=False, indent=2)

import pandas as pd
import plotly.express as px

# --- Load Excel file ---
df = pd.read_excel("your_file.xlsx")

# Clean column names
df.columns = [c.strip().lower().replace(" ", "_") for c in df.columns]

# --- Melt the accuracy columns ---
df_long = df.melt(
    id_vars=["tc", "subtc", "utt"],  # columns to keep
    value_vars=["word_acc", "phrase_acc", "character_acc"],  # columns to melt
    var_name="accuracy_type",
    value_name="accuracy_value"
)

# --- Create grouped bar chart with one facet per 'tc' ---
fig = px.bar(
    df_long,
    x="subtc",
    y="accuracy_value",
    color="accuracy_type",
    facet_col="tc",
    barmode="group",
    text_auto=True,
    color_discrete_sequence=px.colors.qualitative.Set2,
    title="Accuracy Comparison by Task (tc) and Subtask (subtc)",
)

# --- Beautify ---
fig.update_layout(
    font=dict(family="Arial", size=14),
    title_x=0.5,
    title_font=dict(size=20, family="Arial Black"),
    legend_title_text="Accuracy Type",
    plot_bgcolor="white",
    paper_bgcolor="white",
    hovermode="x unified",
    bargap=0.15,
    bargroupgap=0.05,
)

# Clean facet titles
fig.for_each_annotation(lambda a: a.update(text=a.text.split("=")[-1]))

# Format axes
fig.update_yaxes(showgrid=True, gridwidth=0.5, gridcolor="lightgray", title="Accuracy (%)")
fig.update_xaxes(title="Subtask (subtc)")

fig.show()

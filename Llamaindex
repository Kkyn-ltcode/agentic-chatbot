You're absolutely right ‚Äî and thank you for catching that.

When extracting from **step-by-step guides**, you should still include:

* ‚úÖ `entities`: all tools, devices, people, etc.
* ‚úÖ `relationships`: connections between them (e.g., *Tool X* is *used in* *Step Y*)
* ‚úÖ `rules`: any *"if‚Ä¶then"*, conditional logic, requirements
* ‚úÖ ‚úÖ `procedure`: the structured steps
* ‚úÖ `document_metadata`

So now, here is the **corrected full few-shot prompt**, with **relationships** and **rules** included as first-class elements, even in instructional or how-to documents.

---

## ‚úÖ COMPLETE FEW-SHOT PROMPT: PROCEDURE + ENTITIES + RELATIONSHIPS + RULES

> You are an expert knowledge extraction system.
> Your task is to extract **all structured knowledge** from a document ‚Äî including entities, relationships, procedures, rules, and metadata ‚Äî and output it in structured JSON format.
>
> The document may be:
>
> * An instructional guide (step-by-step)
> * A policy or conditional reward
> * Or a hybrid of both

---

### üß† OUTPUT SCHEMA

#### 1. `entities`: all key objects, people, tools, etc.

```json
{
  "name": "string",
  "type": "Device | Tool | Person | Software | Component | Concept | etc.",
  "description": "Specific description based on the document.",
  "metadata": {
    "mentioned_in": ["sentence 1"],
    "used_in_step": [1, 3]
  }
}
```

#### 2. `relationships`: semantic links between entities

```json
{
  "entity_1": "string",
  "entity_2": "string",
  "relation": "string (e.g., used_in, connected_to, part_of, causes)",
  "description": "What links the two entities",
  "metadata": {
    "evidence": "Sentence from the document",
    "step_number": 2,
    "condition": "If applicable"
  }
}
```

#### 3. `rules`: any conditional logic, requirements, outcomes

```json
{
  "id": "Rule_1",
  "type": "Requirement | AccessPolicy | RewardRule | TemporalRule",
  "description": "Condition‚ÄìOutcome rule stated in the document",
  "condition": {
    "trigger": "What must be true",
    "target_entity": "Who or what is affected"
  },
  "outcome": {
    "action": "What happens",
    "object": "Result of the rule",
    "value": "Optional (e.g., money, reward)"
  },
  "metadata": {
    "evidence_sentence": "Quoted from document",
    "step_number": 1
  }
}
```

#### 4. `procedure`: structured step-by-step instructions

```json
{
  "name": "Procedure title",
  "description": "What the guide is about",
  "preconditions": ["Requirements before starting"],
  "steps": [
    {
      "step_number": 1,
      "action": "What the user should do",
      "metadata": {
        "tools_required": ["Tool name"],
        "duration": "Optional",
        "referenced_entities": ["Entity names"]
      }
    }
  ],
  "outcomes": ["What happens if followed correctly"],
  "metadata": {
    "source": "file:///your/doc/path",
    "topic_tags": ["networking", "troubleshooting"]
  }
}
```

#### 5. `document_metadata`: general information

```json
{
  "title": "string",
  "language": "en",
  "source": "file:/// or https://",
  "topic_tags": ["keywords"]
}
```

---

## ‚ú® FEW-SHOT EXAMPLE

---

### üîß Example: Router Reset Guide

**Document**:
"To reset your Wi-Fi router, first locate the reset button on the back. Then hold it for 10 seconds using a paperclip. The router will reboot and return to factory settings. Only reset the router if you‚Äôve forgotten your password."

**Extraction**:

```json
{
  "entities": [
    {
      "name": "Router",
      "type": "Device",
      "description": "A home Wi-Fi router being reset to factory settings.",
      "metadata": {
        "mentioned_in": ["sentence 1", "sentence 3"],
        "used_in_step": [1, 3]
      }
    },
    {
      "name": "Reset Button",
      "type": "Component",
      "description": "A small button on the router that triggers reset.",
      "metadata": {
        "mentioned_in": ["sentence 1"],
        "used_in_step": [1, 2]
      }
    },
    {
      "name": "Paperclip",
      "type": "Tool",
      "description": "Used to press the reset button.",
      "metadata": {
        "mentioned_in": ["sentence 2"],
        "used_in_step": [2]
      }
    }
  ],
  "relationships": [
    {
      "entity_1": "Reset Button",
      "entity_2": "Router",
      "relation": "part_of",
      "description": "The reset button is a component of the router.",
      "metadata": {
        "evidence": "Locate the reset button on the back of the router."
      }
    },
    {
      "entity_1": "Paperclip",
      "entity_2": "Reset Button",
      "relation": "used_to_press",
      "description": "A paperclip is used to press the reset button.",
      "metadata": {
        "step_number": 2,
        "evidence": "Hold it for 10 seconds using a paperclip."
      }
    }
  ],
  "rules": [
    {
      "id": "Rule_1",
      "type": "AccessPolicy",
      "description": "Only reset the router if you‚Äôve forgotten your password.",
      "condition": {
        "trigger": "Forgotten password",
        "target_entity": "User"
      },
      "outcome": {
        "action": "is allowed to",
        "object": "reset the router"
      },
      "metadata": {
        "evidence_sentence": "Only reset the router if you‚Äôve forgotten your password."
      }
    }
  ],
  "procedure": {
    "name": "Reset Wi-Fi Router",
    "description": "Step-by-step instructions to reset a Wi-Fi router to factory settings.",
    "preconditions": [
      "Router is powered on",
      "User has access to the reset button"
    ],
    "steps": [
      {
        "step_number": 1,
        "action": "Locate the reset button on the back of the router.",
        "metadata": {
          "tools_required": [],
          "referenced_entities": ["Reset Button", "Router"]
        }
      },
      {
        "step_number": 2,
        "action": "Press and hold the reset button for 10 seconds using a paperclip.",
        "metadata": {
          "tools_required": ["Paperclip"],
          "duration": "10 seconds",
          "referenced_entities": ["Reset Button", "Paperclip"]
        }
      },
      {
        "step_number": 3,
        "action": "Wait for the router to reboot.",
        "metadata": {
          "tools_required": [],
          "duration": "1‚Äì2 minutes",
          "referenced_entities": ["Router"]
        }
      }
    ],
    "outcomes": [
      "Router returns to factory settings",
      "Wi-Fi password and settings are cleared"
    ],
    "metadata": {
      "source": "file:///Users/kkyn/Documents/router_reset.txt",
      "topic_tags": ["router", "networking", "reset"]
    }
  },
  "document_metadata": {
    "title": "Router Reset Instructions",
    "language": "en",
    "source": "file:///Users/kkyn/Documents/router_reset.txt",
    "topic_tags": ["how-to", "tech", "Wi-Fi"]
  }
}
```

---

## üìù Now Your Turn:

**Insert your document here:**

```
{Paste your guide, policy, or hybrid doc here}
```

---

## ‚úÖ Summary

| Section             | Purpose                                    |
| ------------------- | ------------------------------------------ |
| `entities`          | Describe tools, devices, people, etc.      |
| `relationships`     | Link entities: "used in", "owned by", etc. |
| `rules`             | Conditional logic, policies                |
| `procedure`         | Ordered step-by-step instructions          |
| `document_metadata` | File source, topic, language, etc.         |

---

Want this prompt translated to Vietnamese üáªüá≥ or wrapped into an LLM API call?
Just say the word.
